---
header-includes:
    - \usepackage{ctex}
---

# 3-3 Mooc 解题报告

## 原理

需要实现同时支持取出最大/最小值的双端优先队列。实现方法是维护一个大顶堆、一个小顶堆。插入新数时，为这个数分配一个节点，记录数值、在大顶堆中的秩、在小顶堆中的秩。而在堆中，则存储指向这个节点的指针。每个堆更新时，同时相应地更新节点中存储的秩。需要取出最大值时，先移除大顶堆的顶部元素，得到该元素在小顶堆中的秩，然后从小顶堆中移除；取出最小值时亦同理。

## 遇到的问题

已知元素的秩，将其从堆中移除的策略：不能直接套用一般的下滤方法，因为：

- 移除堆顶元素时，将原来的堆顶与尾部元素交换后，原尾部元素所在的位置（即堆顶）的高度必然不小于它所应该在的位置的高度，所以适用下滤方法。
- 移除任意秩 $r$ 处的元素时，若将该元素与尾部元素交换后，原尾部元素所在的位置($r$) 的高度可能大于也可能小于它所应该在的位置的高度，所以不适用下滤方法。

一种正确的方法是：先在保持其他元素堆序性的前提下，将 $r$ 处元素上浮到堆顶，然后将现在的堆顶元素（即原 $r$ 处元素）和尾部元素交换，最后对现在的堆顶元素（即原尾部元素）进行下滤操作。

## 复杂度分析

- 时间复杂度：相比维护普通的堆仅仅增加常系数。插入、取最大最小值均为 $\mathcal{O}(\log{N})$，总共 $\mathcal{O}(N\log{N})$。
    
- 空间复杂度：维护两个堆和一个记录节点信息的数组，均为 $\mathcal{O}({N})$，总共$\mathcal{O}({N})$。